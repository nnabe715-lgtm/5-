{% extends 'base.html' %}

{% block content %}
<div class="text-center mb-5">
    <h1 class="display-4 fw-bold">ğŸ« 5í•™ë…„ ìš°ë¦¬ë°˜ í™ˆí˜ì´ì§€</h1>
</div>

<div class="row">
    <!-- ì™¼ìª½: ê°€ì •í†µì‹ ë¬¸ -->
    <div class="col-md-7 mb-4">
        <div class="card h-100 shadow-sm">
            <div class="card-header bg-warning text-dark fw-bold">
                ğŸ“¢ ì˜¤ëŠ˜ì˜ ê°€ì •í†µì‹ ë¬¸
            </div>
            <div class="card-body">
                <ul class="list-group list-group-flush">
                    <li class="list-group-item">1. ë‚´ì¼ì€ ì¦ê±°ìš´ í˜„ì¥ì²´í—˜í•™ìŠµ ë‚ ì…ë‹ˆë‹¤. ğŸˆ</li>
                    <li class="list-group-item">2. ì¤€ë¹„ë¬¼: ë„ì‹œë½, ë¬¼, ë—ìë¦¬, ëª¨ì</li>
                    <li class="list-group-item">3. 8ì‹œ 40ë¶„ê¹Œì§€ êµì‹¤ë¡œ ëŠ¦ì§€ ì•Šê²Œ ì˜¤ì„¸ìš”.</li>
                    <li class="list-group-item">4. ìˆ™ì œ: ìˆ˜í•™ìµí˜ì±… 30~31ìª½ í’€ì–´ì˜¤ê¸°</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- ì˜¤ë¥¸ìª½: ë¡œê·¸ì¸ ë° ê¸°ëŠ¥ -->
    <div class="col-md-5 mb-4">
        <!-- ë¡œê·¸ì¸ ì „: ë¡œê·¸ì¸ í¼ -->
        <div id="guest-area" class="card shadow-sm">
            <div class="card-body">
                <h3 class="card-title text-center mb-4">ë¡œê·¸ì¸</h3>
                <form id="login-form">
                    <div class="mb-3">
                        <label class="form-label">ì•„ì´ë””</label>
                        <input type="text" id="login-id" class="form-control" placeholder="ì˜ˆ: nnabe" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" id="login-pw" class="form-control" required>
                    </div>
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary">ë¡œê·¸ì¸</button>
                        <a href="/register" class="btn btn-outline-secondary">íšŒì›ê°€ì…</a>
                    </div>
                </form>
            </div>
        </div>

        <!-- ë¡œê·¸ì¸ í›„: í™˜ì˜ ë©”ì‹œì§€ ë° ì¶œì„ì²´í¬ ë²„íŠ¼ -->
        <div id="member-area" class="card shadow-sm bg-light" style="display: none;">
            <div class="card-body text-center p-5">
                <h3 class="card-title mb-3">í™˜ì˜í•©ë‹ˆë‹¤! ğŸ‘‹</h3>
                <p class="card-text mb-4">ì˜¤ëŠ˜ë„ ì¦ê±°ìš´ í•˜ë£¨ ë³´ë‚´ì„¸ìš”.</p>
                <a class="btn btn-success btn-lg w-100" href="/attendance">
                    âœ… ì¶œì„ì²´í¬ í•˜ëŸ¬ê°€ê¸°
                </a>
            </div>
        </div>
    </div>
</div>

<script type="module">
    import { auth } from "/static/firebase.js";
    import { onAuthStateChanged, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

    // ë¡œê·¸ì¸ ìƒíƒœ ëª¨ë‹ˆí„°ë§
    onAuthStateChanged(auth, (user) => {
        if (user) {
            document.getElementById('guest-area').style.display = 'none';
            document.getElementById('member-area').style.display = 'block';
        } else {
            document.getElementById('guest-area').style.display = 'block';
            document.getElementById('member-area').style.display = 'none';
        }
    });

    // ë¡œê·¸ì¸ í¼ ì œì¶œ ì²˜ë¦¬
    const loginForm = document.getElementById('login-form');
    if (loginForm) {
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const idInput = document.getElementById('login-id').value;
            const pwInput = document.getElementById('login-pw').value;
            
            // ê´€ë¦¬ì ì•„ì´ë””(nnabe) ë° ë¹„ë°€ë²ˆí˜¸(1234) ì²˜ë¦¬ ë¡œì§
            const email = idInput.includes('@') ? idInput : idInput + '@school.com';
            const password = pwInput === '1234' ? '123456' : pwInput;

            try {
                await signInWithEmailAndPassword(auth, email, password);
                // ì„±ê³µ ì‹œ onAuthStateChangedê°€ UIë¥¼ ì—…ë°ì´íŠ¸í•¨
            } catch (error) {
                alert("ë¡œê·¸ì¸ ì‹¤íŒ¨: ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.");
            }
        });
    }
</script>
{% endblock %}